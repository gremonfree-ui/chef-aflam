<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #FFD700; --bg: #121212; --panel: #1E1E1E; --text: #E0E0E0; --border: #333; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { background: var(--panel); padding: 40px; border-radius: 10px; border: 1px solid var(--border); text-align: center; width: 90%; max-width: 400px; }
        .input-field { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid var(--border); color: #fff; border-radius: 5px; box-sizing: border-box; }
        
        .container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 260px; background: #000; border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; }
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        
        .btn { padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--primary); color: #000; margin-top: 10px; }
        .btn-nav { background: transparent; color: #888; justify-content: flex-start; }
        .btn-nav:hover, .btn-nav.active { background: var(--panel); color: #fff; }
        .btn-nav.active { color: var(--primary); }
        
        .btn-icon { width: 30px; height: 30px; padding: 0; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #fff; border: 1px solid #444; background: #333; }
        .btn-icon:hover { background: #555; }
        .btn-danger { background: #5a1a1a; border-color: #ff4444; color: #ff4444; }

        .card { background: var(--panel); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--border); position: relative; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.85rem; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .controls { display: flex; gap: 5px; position: absolute; top: 20px; right: 20px; }
        .loader { width: 20px; height: 20px; border: 3px solid #333; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .preview-img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; margin-top: 10px; background: #000; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:var(--primary)"><i class="fas fa-lock"></i> SUPER ADMIN</h2>
            <input type="password" id="token-input" class="input-field" placeholder="Paste GitHub Token">
            <button class="btn btn-primary" onclick="login()">Login</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h2 style="color:#fff; text-align:center; margin:0 0 20px 0">CHEF <span style="color:var(--primary)">AFLAM</span></h2>
            
            <button class="btn btn-nav active" onclick="switchTab('tab-ai', this)"><i class="fas fa-robot"></i> ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
            <button class="btn btn-nav" onclick="switchTab('tab-editing', this)"><i class="fas fa-film"></i> ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬</button>
            <button class="btn btn-nav" onclick="switchTab('tab-designs', this)"><i class="fas fa-palette"></i> Ù…Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª</button>
            <hr style="width:100%; border:0; border-top:1px solid #333; margin:10px 0">
            <button class="btn btn-nav" onclick="switchTab('tab-general', this)"><i class="fas fa-sliders-h"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</button>
            <button class="btn btn-nav" onclick="switchTab('tab-profile', this)"><i class="fas fa-user-circle"></i> Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
            
            <div style="flex:1"></div>
            <button class="btn btn-primary" onclick="saveChanges()">
                <span id="save-text">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</span>
                <div class="loader" id="save-loader"></div>
            </button>
        </div>

        <div class="main">
            
            <div id="tab-ai" class="tab-content active">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI Videos)</h2>
                    <button class="btn" style="width:auto; background:#333; color:var(--primary)" onclick="addItem('ai_videos')">+ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div id="list-ai_videos"></div>
            </div>

            <div id="tab-editing" class="tab-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2>ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ (Editing)</h2>
                    <button class="btn" style="width:auto; background:#333; color:var(--primary)" onclick="addItem('editing_videos')">+ ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div id="list-editing_videos"></div>
            </div>

            <div id="tab-designs" class="tab-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2>Ù…Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª (Gallery)</h2>
                    <button class="btn" style="width:auto; background:#333; color:var(--primary)" onclick="addDesign()">+ ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div id="list-designs"></div>
            </div>

            <div id="tab-general" class="tab-content">
                <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                <div class="card">
                    <h3><i class="fas fa-scroll"></i> Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ticker)</h3>
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ù„ÙŠ Ø¨ÙŠØªØ­Ø±Ùƒ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ù… Ø¨Ø¹Ù„Ø§Ù…Ø© | )</label>
                        <input class="input-field" id="ticker-text" placeholder="VIDEO EDITOR | AI ARTIST">
                    </div>
                </div>
                <div class="card">
                    <h3><i class="fas fa-star"></i> ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                        <input class="input-field" id="hero-url" placeholder="https://vimeo.com/...">
                    </div>
                </div>
            </div>

            <div id="tab-profile" class="tab-content">
                <h2>Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„</h2>
                <div class="card">
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</label>
                        <div style="display:flex; gap:10px">
                            <input type="text" id="prof-img" class="input-field" style="margin:0">
                            <input type="file" id="file-prof" hidden onchange="uploadImage(this, 'prof-img')">
                            <button class="btn-icon" style="width:auto; padding:0 15px" onclick="document.getElementById('file-prof').click()"><i class="fas fa-upload"></i> Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
                        </div>
                    </div>
                    <div class="form-group"><label>Ø§Ù„Ø§Ø³Ù…</label><input class="input-field" id="prof-name"></div>
                    <div class="form-group"><label>Ù†Ø¨Ø°Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label><textarea id="bio-en" class="input-field" rows="3"></textarea></div>
                    <div class="form-group"><label>Ù†Ø¨Ø°Ø© (Ø¹Ø±Ø¨ÙŠ)</label><textarea id="bio-ar" class="input-field" rows="3" style="direction:rtl"></textarea></div>
                </div>
                <div class="card">
                    <h3>Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</h3>
                    <div class="form-group"><label>LinkedIn</label><input class="input-field" id="social-linkedin"></div>
                    <div class="form-group"><label>YouTube</label><input class="input-field" id="social-youtube"></div>
                    <div class="form-group"><label>Instagram</label><input class="input-field" id="social-instagram"></div>
                    <div class="form-group"><label>Email</label><input class="input-field" id="social-email"></div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ==========================================
        // Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ØµØ­ÙŠØ­Ø©
        // ==========================================
        const GITHUB_USERNAME = 'gremonfree-ui'; 
        const REPO_NAME = 'chef-aflam';
        const DB_FILE = 'db.js';

        let db = {
            general: { ticker: "", hero_video: "" },
            profile: { name: "", image: "", bio_en: "", bio_ar: "", linkedin: "", youtube: "", instagram: "", email: "" },
            editing_videos: [], 
            ai_videos: [],      
            designs: []
        };
        
        let token = localStorage.getItem('gh_token');
        let fileSha = null;

        if(token) { document.getElementById('login-screen').style.display = 'none'; fetchData(); }

        function login() {
            const t = document.getElementById('token-input').value.trim();
            if(!t) return;
            localStorage.setItem('gh_token', t);
            token = t;
            document.getElementById('login-screen').style.display = 'none';
            fetchData();
        }

        async function fetchData() {
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DB_FILE}`, { headers: { Authorization: `token ${token}` } });
                if(res.ok) {
                    const data = await res.json();
                    fileSha = data.sha;
                    const content = decodeURIComponent(escape(atob(data.content)));
                    const jsonPart = content.replace(/const\s+db\s*=\s*/, '').replace(/;$/, '');
                    db = { ...db, ...JSON.parse(jsonPart) };
                }
                renderUI();
            } catch(e) { console.error(e); }
        }

        function renderUI() {
            // General
            if(db.general) {
                document.getElementById('ticker-text').value = db.general.ticker || '';
                document.getElementById('hero-url').value = db.general.hero_video || '';
            }

            // Profile
            document.getElementById('prof-img').value = db.profile.image || '';
            document.getElementById('prof-name').value = db.profile.name || '';
            document.getElementById('bio-en').value = db.profile.bio_en || '';
            document.getElementById('bio-ar').value = db.profile.bio_ar || '';
            
            // Social
            document.getElementById('social-linkedin').value = db.profile.linkedin || '';
            document.getElementById('social-youtube').value = db.profile.youtube || '';
            document.getElementById('social-instagram').value = db.profile.instagram || '';
            document.getElementById('social-email').value = db.profile.email || '';

            // Lists (Ù…Ù‡Ù…: Ø±Ø¬Ø¹Ù†Ø§ file Ø¨Ø¯Ù„ url Ø¹Ø´Ø§Ù† Ø§Ù„Ø¯Ø§ØªØ§ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØªØ¸Ù‡Ø±)
            renderVideoList('editing_videos', db.editing_videos);
            renderVideoList('ai_videos', db.ai_videos);
            renderDesignList(db.designs || []);
        }

        function renderVideoList(type, list) {
            const container = document.getElementById('list-' + type);
            container.innerHTML = '';
            if(!list) return;
            list.forEach((item, i) => {
                // Ù‡Ù†Ø§ Ø§Ù„Ø³Ø±: Ø¨Ù†Ø³ØªØ®Ø¯Ù… item.file Ù…Ø´ item.url
                const val = item.file || item.url || ""; 
                container.innerHTML += `
                <div class="card">
                    <div class="controls">
                        <button class="btn-icon" onclick="moveItem('${type}', ${i}, -1)"><i class="fas fa-arrow-up"></i></button>
                        <button class="btn-icon" onclick="moveItem('${type}', ${i}, 1)"><i class="fas fa-arrow-down"></i></button>
                        <button class="btn-icon btn-danger" onclick="delItem('${type}', ${i})"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label><input onchange="updateList('${type}', ${i}, 'file', this.value)" value="${val}" class="input-field"></div>
                    <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (EN)</label><input onchange="updateList('${type}', ${i}, 'title_en', this.value)" value="${item.title_en||''}" class="input-field"></div>
                    <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (AR)</label><input onchange="updateList('${type}', ${i}, 'title_ar', this.value)" value="${item.title_ar||''}" class="input-field" style="direction:rtl"></div>
                </div>`;
            });
        }

        function renderDesignList(list) {
            const container = document.getElementById('list-designs');
            container.innerHTML = '';
            if(!list) return;
            list.forEach((item, i) => {
                container.innerHTML += `
                <div class="card">
                    <div class="controls">
                        <button class="btn-icon" onclick="moveItem('designs', ${i}, -1)"><i class="fas fa-arrow-up"></i></button>
                        <button class="btn-icon" onclick="moveItem('designs', ${i}, 1)"><i class="fas fa-arrow-down"></i></button>
                        <button class="btn-icon btn-danger" onclick="delItem('designs', ${i})"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
                        <div style="display:flex; gap:10px">
                            <input type="text" id="design-img-${i}" onchange="updateList('designs', ${i}, 'url', this.value)" value="${item.url||''}" class="input-field" style="margin:0">
                            <input type="file" id="file-design-${i}" hidden onchange="uploadImage(this, 'design-img-${i}', 'designs', ${i})">
                            <button class="btn-icon" style="width:auto; padding:0 15px" onclick="document.getElementById('file-design-${i}').click()"><i class="fas fa-upload"></i></button>
                        </div>
                        ${item.url ? `<img src="${item.url}" class="preview-img">` : ''}
                    </div>
                    <div class="form-group"><label>ÙˆØµÙ</label><input onchange="updateList('designs', ${i}, 'desc', this.value)" value="${item.desc||''}" class="input-field"></div>
                </div>`;
            });
        }

        // --- Logic & Helpers ---
        window.updateList = (type, i, key, val) => { db[type][i][key] = val; };
        
        window.addItem = (type) => {
            if(!db[type]) db[type] = [];
            db[type].push({ file: "", title_en: "New Project", title_ar: "Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯" });
            renderUI();
        };

        window.addDesign = () => {
            if(!db.designs) db.designs = [];
            db.designs.push({ url: "", desc: "" });
            renderUI();
        };

        window.delItem = (type, i) => {
            if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±ØŸ')) return;
            db[type].splice(i, 1);
            renderUI();
        };

        window.moveItem = (type, i, dir) => {
            if (dir === -1 && i === 0) return;
            if (dir === 1 && i === db[type].length - 1) return;
            const temp = db[type][i];
            db[type][i] = db[type][i + dir];
            db[type][i + dir] = temp;
            renderUI();
        };

        window.switchTab = (id, btn) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.btn-nav').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        };

        async function uploadImage(input, targetId, listType=null, index=null) {
            const file = input.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                const content = e.target.result.split(',')[1];
                const path = `images/${Date.now()}_${file.name.replace(/\s/g,'_')}`;
                
                try {
                    const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${path}`, {
                        method: 'PUT',
                        headers: { Authorization: `token ${token}` },
                        body: JSON.stringify({ message: "Upload Image", content: content })
                    });
                    if(res.ok) {
                        const imgUrl = `https://${GITHUB_USERNAME}.github.io/${REPO_NAME}/${path}`;
                        document.getElementById(targetId).value = imgUrl;
                        
                        if(listType === 'designs') db.designs[index].url = imgUrl;
                        else if(targetId === 'prof-img') db.profile.image = imgUrl;
                        
                        if(listType === 'designs') renderUI();
                        alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                    }
                } catch(err) { console.error(err); alert('ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ âŒ'); }
            };
            reader.readAsDataURL(file);
        }

        async function saveChanges() {
            // Collect General & Profile Data
            db.general.ticker = document.getElementById('ticker-text').value;
            db.general.hero_video = document.getElementById('hero-url').value;

            db.profile.name = document.getElementById('prof-name').value;
            db.profile.image = document.getElementById('prof-img').value;
            db.profile.bio_en = document.getElementById('bio-en').value;
            db.profile.bio_ar = document.getElementById('bio-ar').value;
            db.profile.linkedin = document.getElementById('social-linkedin').value;
            db.profile.youtube = document.getElementById('social-youtube').value;
            db.profile.instagram = document.getElementById('social-instagram').value;
            db.profile.email = document.getElementById('social-email').value;

            const btn = document.getElementById('save-text');
            const loader = document.getElementById('save-loader');
            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...'; loader.style.display = 'block';

            const jsContent = `const db = ${JSON.stringify(db, null, 4)};`;
            const encodedContent = btoa(unescape(encodeURIComponent(jsContent)));
            
            const body = { message: "Update via Super Admin", content: encodedContent };
            if(fileSha) body.sha = fileSha;

            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DB_FILE}`, {
                    method: 'PUT',
                    headers: { Authorization: `token ${token}` },
                    body: JSON.stringify(body)
                });
                if(res.ok) {
                    const data = await res.json();
                    fileSha = data.content.sha;
                    alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø³ÙŠØªØ­Ø¯Ø« Ø®Ù„Ø§Ù„ Ø¯Ù‚ÙŠÙ‚Ø©.');
                } else alert('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­.');
            } catch(e) { console.error(e); } 
            finally { btn.innerText = 'Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'; loader.style.display = 'none'; }
        }
    </script>
</body>
</html>